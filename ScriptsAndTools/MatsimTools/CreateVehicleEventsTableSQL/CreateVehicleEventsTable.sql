drop table if exists vehicle_events;
create table vehicle_events (veh_id text, event_time real, longitude double precision, latitude double precision);
insert into vehicle_events select events.veh_id as veh_id, events.event_time as event_time, ST_X(matsimnodes.geom) as longitude, ST_Y(matsimnodes.geom) as latitude from events, matsimlinks, matsimnodes where events.type='entered link' and events.link_id=matsimlinks.link_id and matsimlinks.from_id=matsimnodes.id order by events.veh_id, events.event_time;
insert into vehicle_events select processed_events.veh_id as veh_id, processed_events.event_time as event_time, ST_X(matsimschedule.geom) as longitude, ST_Y(matsimschedule.geom) as latitude from (select events.event_time as event_time, events.veh_id as veh_id, split_part(events.fac_id, '.', 1) as fac_id from events where events.type='VehicleArrivesAtFacility') as processed_events, matsimschedule where processed_events.fac_id=matsimschedule.id order by processed_events.veh_id, processed_events.event_time;